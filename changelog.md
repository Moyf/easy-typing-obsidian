## 更新日志 Changelog
- v5.1.9 2023-02-23
  - 增加了实验性功能
    - 仅在输入过程中，中文间的英文标点（,.?!）自动转换为全角（可撤销）。该功能默认关闭，需要到设置中打开。
  - 一些改动
    - 将连续顿号转`/`的设定从默认的连续全角转半角功能中删除，需要该功能可通过设置中的自定义转换规则实现。 #127
    - 适配了前面带两个!的MD链接和 wiki 链接，为了适配Make.MD插件的 flow editor.
- v5.1.8 2023-02-11
  -  Bug fix
     -  fix cursor move when use command to format article. #126
     -  fix english number space settings not work.
     -  fix english number space and chinese number space sometimes not work.
- v5.1.7 2023-02-09
  - New Feature
    - Add Experimental Feature: Strict Line breaks Mode Enter Twice (when you turn on the strict line breaks in editor settings, one enter will produce two `\n`) 增加了实验性功能：在编辑器设置了严格换行的情况下，在普通文本行使用回车键会产生两个换行符。
    - Add Experimental Feature: Enhance Chinese Input Method （Which is designed to fix the issue #125）增加了实验性功能：中文输入法下输入英文，回车让英文上屏时自动格式化。
    - The experimental functionality needs to be updated and turned on in the plug-in settings, with the default off. 实验性功能需要更新后在插件设置中打开，默认为关闭。
- v5.1.6 2023-02-08
  - 插件命令正式支持中文，会根据数字OB设置的语言变化。 #116
  - 数字间的逗号和点号不再触发添加空格。 #121
  - ios端粘贴文本不会触发自动格式化了， #124
  - 设置中添加了数字和中文，数字和英文的空格选项 #117
  - 格式化全文、格式化选中文本产生的变化被整合到一个transaction，可以一次撤销。
- v5.1.5 2023-01-27
  - Bug fix
    - fix #119。修复选中文本后输入两次$时的结果与期望不同
  - Improvement
    - add chinese command name. 插件命令添加中文描述
    - improve delete blank line command for blockid 删除空白行不会删除blockid后的空白行了。
  - changed
    - no longger add soft space between timestamp and text. 自动格式化不再要求文本和识别的时间戳之间有软空格。
- v5.1.4 2023-01-18
  - Bug fix
    - Fix #114
  - Improve
    - 重新安装插件后无需重启软件即可生效。After reinstalling the plug-in, it will take effect without restarting the software.
  - Changed
    - 空格后面及句首的符号`.`不再被认为是句子的结束。（相当于不会错误地将文本中的拓展名如 `.txt` 自动格式化成 `. txt`，需要`.`前面有空格）The sign `.` after a space or at the beginning of a sentence is no longer considered the end of a sentence. (That is to say this plugin will not accidentally format the extension name in the text such as `.txt` to `. Txt` automatically, requiring `.` to be preceded by a space) 
- v5.1.3 2023-01-10
  - Bug fix
    - Fix #107
- v5.1.2 2022-12-29
  - Bug Fix
    - Fix dummy+soft link space strategy not work as expected
    - Improve timestamp recognize, now support 12:12:12, 1:22 ...
  - Changes
    - bad regexp notice now only appear when debug switch is on.
- v5.1.1 2022-12-12
  - Bug Fix
    - 修复了当前文件路径不更新导致的检查是否为排除文件总是返回真的问题。#105
- v5.1.0
  - New Feature
    - 增加了Tabout功能，可以在光标在行内代码中时按Tab跳出行内代码。Tabout inline code.
  - Improve
    - 修复了公式块在不规范书写的时候可能会导致后续部分自动格式化失效的问题。Fixed an issue where the automatic formatting could fail when the formula blocks were not properly written.
    - 用 syntaxTree 模块完全代替了自己的 ArticleParser 文章内容解析器。应该会带来性能的提升。The syntaxTree module completely replaces my own ArticleParser(article content parser). There should be a performance boost.
  - Other
    - 增加了 buymeacoffee 赞助链接. Add a fundingUrl of buymeacoffee.
- v5.0.12 2022.12.07
  - Improvement
    - 增强了一键去除空格命令(Easy Typing: Delete blank lines of the selected area or whole article)的逻辑，不再去除列表、callout后面的第一个空白行，以及水平线前的第一个空白行。(enhance command:delete blank line. no longer delete first blank line after list, task, callout and blank line exact before hr)
- v5.0.10 2022.11.07
  - bug fix
    - 修复转换规则在某些输入法下对中文符号 —— 不生效的 Bug。#96
  - enhancement
    - 增加行开头为有引号 “ 的文本的首字母大写。#97
- v5.0.9 2022.10.29
  - Bug Fix
    - 修复回车换行时的自动格式化在该行是列表或Task时失效的问题
    - 修复链接右边的智能空格不正确的问题
- v5.0.8 2022.10.29
  - Bug fix
    - 修复在关闭自动格式化时粘贴文本还会触发自动格式化的 Bug。Fix paste auto format when autoformat switch off
    - 尝试修复在某些输入法下，转换规则在输入全角字符时不生效的 Bug。Try to fix convert rule not work when input fullwidth symbol.
  - Inprovement
    - 现在选中替换规则的左右字符串可以为空。Now Selection Replace Rule's left and right char can be left blank.
- V5.0.7 2022.10.16
  - 结合 @codemirror/language SyntaxTree 来解析行，行解析更准确。 #57 #84。 parser line with help of @codemirror/language SyntaxTree, make it more robust.
- V5.0.6 2022.10.15
  - 修复上个版本的小更新导致的和 Latex suite 冲突的问题。
  - 修改一些设置面板的描述，和文档更新。
- V5.0.5 2022.10.14
  - 自动格式化会忽略 frontmatter 区域。 autoformat ignore frontmatter
  - 设置中增加自动格式化忽略文件、文件夹。support exclude folder/files for autoformat
  - 增加粘贴内容时的自动格式化。support autoformat when paste.
  - 增加删除多余空白行的命令（选中文本情况下只删除选中区域的空白行，未选中文本情况下对全文删除空白行）。add command to delete blank lines
  - <> 符号不再自动配对，如有需要可以在设置自定义规则实现。
- V5.0.4 2022.10.10
  - fix bug which cause conflict with obsidian-latex-suite
- V5.0.3 2022.10.05
  - 增加缩写的识别,缩写部分不被格式化(#48, #5)。 缩写指的是符合正则表达式 `/([a-zA-Z]\.)+/` 的部分，如 i.e.
  - 修复代码区块和公式区块类型改变时却没触发文档重解析的 bug。
- V5.0.1~V5.0.2 2022.10.03
  - 现在 * ~ 都会被认为是软空格. fix #41, now ~ * are considered as soft space
  - 自定义转换规则支持换行. User defined conversion rules now support line breaking.
- V5.0.0 2022.09.26
  - 重构了代码框架，使用新的接口重新实现了之前的所有功能，大大提升了本插件的性能及可拓展性，并且添加了一些新的功能。
  - 新功能与改进
  	- **增加了对移动端的支持**！
  	- **取消了行模式**，得益于新接口的使用，现在本插件能更好地识别出中文输入法的结束，无需行模式也不再会有之前的输入错乱的 Bug。现在，插件在每次中文输入结束和英文字符输入的时候进行文本的格式化。
  	- **增强了符号自动配对及增加了配对符号的快速删除功能**，光标在配对的符号之间时，按删除键会将整个配对符号全部删除，如在《|》时按删除键，会直接将两个书名号全部删除。支持更多符号对如：`“”`、`$$`、`（）` 等。
  	- 细化了对符号输入增强的功能分类并分别设置了开关：1. 符号自动配对/删除；2. 选中文本的符号编辑增强；3. 连续全角符号转半角符号；4. Obsidian 语法相关的编辑增强。详见 readme 文档。
  	- **增加了自定义编辑转换规则**，支持自定义选中文本、退格键删除文本以及打字时三种情况下的文本转换规则。（参考了 [aptend/typing-transformer-obsidian](https://github.com/aptend/typing-transformer-obsidian)）
  	- **增加了不同区块空格策略的设定**，三种空格策略：1. 无要求；2. 软空格；3. 严格空格。软空格指当前区块可以与其他区块以标点符号分割（如 `$formula-block$，文本区块` 中公式区块和文本区块以逗号分割，该逗号就算软空格），严格空格指该区块和其他区块之间必须有空格符号分割。
  	- 现在，**每个自定义区块左右两边的空格策略都可以单独设置**，大大增强了正则区块的实用性和可玩性。详见 readme 文档。
  	- 增加了一个插入代码块的命令: "insert code block w/wo selection"。可以在选中和未选中文本的情况下自适应地插入代码块语法（为了我自己方便）
  	- **提升了性能**。
  - 功能变化
  	- 由于使用 CodeMirror 6 API，**不再支持 Legacy Editor**。
  - 致谢
  	- 感谢插件 [aptend/typing-transformer-obsidian](https://github.com/aptend/typing-transformer-obsidian) ，通过该插件了解了CodeMirror6 的相关 API 的使用。以及该插件通用转换规则的思路也对本插件有所启发。
- V4.0.8 2022.09.05
  - Bug Fix
    - Auto-capitalization now work for cyrillic symbols #65
    - 调整了中文引号的自动补全 #64
    - 调整引号和其他区块的自动空格的特性。 #63
- V4.0.7 2022.08.23
  - Bug Fix
    - Fix Smart Space between text and link. #60
- V4.0.6 2022.04.27
  - Improvement
    - improve action when press 3 contiguous `·`。连续三次`·`的处理得到增强
  - Bug fix
    - fix press `{` when something selected will cause duplication. 修复在选中文本时按`{`会产生重复文本的问题。 #40
- V4.0.5 2022.04.06
  - Improvement
    - 全角字符增强功能：增加了中文括号、书名号、引号的自动配对输入。
    - 优化了插件设置面板
- V4.0.4 2022.03.27
  - Bug fix
    - 修复在 Ubuntu 下，全角增强开启下两次`：`不会变成`:`的 bug。
- V4.0.3 2022.03.27
  - New Feature
    - 新增了行模式：只在一行输入结束，回车创建新行的时候，对该行进行格式化。可以在插件设置中打开(Add LineMode: Only formatting when line end. need to be activated in setting pane)
  - Improvement
    - 增加了格式化全文的命令（add command to foramt the whole article）
    - format-selection 命令在没有选中文本的情况下，格式化当前行。（format-selection command will format current line when there is no selection）
  - Bug fix
    - 修复了链接后面错误添加空格的 bug。（fix bug: sometime it mistakenly add space after link）
    - 修复全角增强功能在 linux 下两次 `；`不会转换成 `;` 的 bug
  - Others
    - 建议在插件设置中的正则表达式设置中添加两行正则: 
      - `\[\!.*?\][+-]{0,1}` 用于排除对 Obsidian 0.14 版本后新增的 callout 类型的格式化 
      - `<.*?>` 用于排除 Templater 插件特定语法的格式化。
- V4.0.1 2022.02.21
  - Improvement
    - 全角字符增强，增加了对Mac系统下两次中文竖线变英文竖线的功能 #24
    - 全角字符增强，调整增强了对 》 以及 $ 的操作
- V4.0.0 2022.02.09 
    - Improvement
        - **同时支持 live preview 模式 (Support Live preview) 和 legacy editor**
        - 优化文本解析的时机和解析的范围，提升性能；在切换文档的时候重新解析文档。
        - 支持 Admonition 代码块内部文本自动格式化
        - 增加命令：格式化选中的文本
        - 增强了 `链接与文本智能空格` 的功能
        - 大大增强了 `全角字符输入增强/辅助` 功能
        - 回车后，对上一行文本进行格式化
    - Bug fix
        - 解决了某些情况下，格式化行时最终光标计算错误的 Bug。
        - 修复了解析全文时，在某些情况下在全文最后会多计算一行 undefined 的 Bug

---
- v3.4.3 2021.11.18
  - Bug fix
    - fix that two successive `：` will be converted to `:` not working in ubuntu;
- v3.4.2 2021.11.18
  - New feature
    - Add new feature to full-width symbol enhancement. Two successive `：` will be converted to `:`; two successive `》` will be converted to `>`; two successive `。` will be converted to `.`; two successive `、` will be converted to `/`; two successive `（` will be converted to `()`, and the cursor will be in the middle. It only works when you input, and it won't affect the existing context. 为全角符号增强添加新功能。 两个连续的`：`将被转换为`:`； 两个连续的`》`将被转换为`>`； 两个连续的`。`将被转换为`.`； 两个连续的`、`将被转换为`/`； 两个连续的`（`会被转换成`()`，光标会在中间。该功能只在你输入的时候触发，不会影响已经存在的文本。
- v3.4.1 2021.11.17
  - Improvement
    - Be compatible with plugins: Obsidian Emoji Shortcodes. 与插件 Obsidian Emoji Shortcodes 兼容。
- v3.4.0 2021.10.23
  - New feature
    - 全角字符增强功能增加了行首的`》`自动转换成`>`，行首的`、`自动转换成`/`（为了配合核心插件slash commands）。The full-width character enhancement has new feature: The `》` at the beginning of the line is automatically converted to `>`, and the `and` at the beginning of the line are automatically converted to `/` (in order to cooperate with the core plug-in slash commands) #17
  - Bug fix
    - 修复了鼠标点击到新的空白行首再输入时，句首字母大写失效的问题。Fixed an issue where capitalizing the first letter of a sentence would not work when clicking on the beginning of a blank line
- v3.3.5 2021.10.20
  - Bug fix
    - Try to fix #17 which happened on MacOS: 2 `￥` can't convert to `$$`。
- v3.3.4 2021.9.29
  - Improvement
    - 提升了对链接的识别，不带`https://` 的 www.开头的链接也能识别。Enhance the recognization for link, link not begin with `https://` but begin with `www.` can be recognized.
  - Changes
    - 全角字符增强的功能不再将中文省略号（中文输入法下`shift+6`）自动转化成`^`。The enhanced function of full-width characters no longer automatically converts Chinese ellipsis (`shift+6` under Chinese input method) into `^`.
- v3.3.3 2021.6.22
  - Change
    - 移除了分号后面的首字母大写，英文用法中分号后面不用大写。Remove capitalization after ";", for I had midsunderstood the use of ";" in English.
- v3.3.2 2021.6.20
  - bug fix
    - 修复了首字母大写在某些情况失效的bug. Fixed a bug where initial capitalization failed in some cases.
- v3.3.0 2021.6.19
  - Shinny new things
    - 首字母大写可撤销 Feature of capitalizing the first letter of every sentence is revocable now.
    - 增加了[[wikilink]]的智能空格选项，可以根据其上下文决定是否加空格。 Add setting for smart spacing for [[wikilink]], which decide whether to add spaces from the context.
  - Bug fix
    - 解决了之前格式化一行文本的命令不生效的bug。Fixed a bug where formatting a line of text doesn't work
- v3.2.2 2021.6.16
  - Improvement
    - 增加了对错误的自定义正则的处理，修复了空字符串的正则导致软件卡死的bug, 正则表达式功能应该没问题了。
    - 修改了formatLine的方式，只对一行中需要格式化的部分进行replaceRange，解决了一行中如果有%`-时每次格式化都需要重新解析全文的问题，提升了性能。
    - 全角字符增强的功能增加了输入……（shift+6）转换为^的功能。issue #10.
    - 修改了很多if-else，改成switch，略微提升性能
- v3.2.1 2021.6.10
  - Improvement
    - 增加了连续三次键入·，会变成\`\`\`
- v3.2.0 2021.6.10
  - Shiny new things
    - 增加了用户自定义正则表达式的功能，对正则表达式选取的部分不进行格式化。如`:\w*:`将识别emoji，并不会格式化其内部。`{{.*?}}`将识别双花括号部分，并对其内部不格式化。
    - 还可以选择自定义区块和其他文本区块之间空格。
  - Change
    - 合并了之前的 wikilink, mdlink, barelink，统称为link，相关的自动空格开关也合并为1个。
  - Others
    - 部分代码重新命名/注释，更加清晰
- v3.1.9 2021.6.9
  - Bug fix
    - 修复 v3.1.8 全角输入增强对 Mac 版本 obsidian无效的问题
- v3.1.8 2021.6.9
  - Improvement
    - 增加了全角符号输入增强，现在连续两个￥￥会变成$$，并将光标定位到中间，输入两个【会变成`[[cursor]]`，同理输入两个`·`会变成\`cursor\`
    - 重写了splitLine函数，改善逻辑，增加可维护性，并支持行内`$$block formula$$`的识别。  
    - readme 增加了对插件设置面板的说明
- v3.1.7 2021.6.7
  - Improvement
    - selectFormat 增加了选中文本时按【则在文本两边增加`[]`的效果.
    - 现在选中文本再【或者￥后，文本还保持选中
    - list或者task内部开头的整行公式(如`$$x+y=z$$`)现在也能被识别，不会导致错误的格式化。
- v3.1.6 2021.5.28
  - Improvement
    - 在设置项增加了Debug，可以在控制台输出调试信息，方便调试。
  - Bug fix
    - 修复光标定位新行时，prevCursor没更新导致的bug。
- v3.1.5 2021.5.28
  - Bug fix
    - 修复了在text类型的行编辑后，光标定位到codeblock内编辑情况下，format会对codeblock起作用的bug。
- v3.1.4 2021.5.26
  - Improvement
    - Reduce computatio: 不再在每次按键输入时解析全文，分析段的类型，而是在文本行数变化，或者在本文增减 `$- 这几个符号的时候重新解析全文的行类型。 
    - Effect change: 修改了数字空格选项的逻辑，不再在数字与字母之间空格。
  - Bugs fix
    - set `manifest.json`: `"isDesktopOnly": true`, Since I'm using the CodeMirror 5 API
    - remove unused imports
    - unhook events in `onunload()`
- v3.1.3 2021.5.16
  - bug fix
    - [x] 修复了标题首字母大写不生效的bug
    - [x] 修复了`[https://xxx]()` mdlink中方括号内部两边会自动生成空格的问题。 
- v3.1.2 2021.5.16
  - bug fix
    - [x] 文本和inline元素之间打空格回多添加一个空格, that won't happen again.
- v3.1.1 2021.5.15
  - Improve
  	- [x] 选中文本情况下，按中文的￥键，将自动替换成$，变成行内公式
  	- [x] 选中文本情况下，按中文的·，将自动替换成`，变成行内代码块
- v3.1.0 2021.5.14
  - Improve
    - **增加了全文的内容识别，在全文语境下的代码块和公式中不自动格式化**
    - 增加了快捷键：全文格式化
    - 增加了快捷键：AutoFormat 开关切换
    - Md 链接将不论小括号内容
- v3.0.1
  - bug fix
    - 修复了inline code 等元素和前后的标点符号空格的bug。
- v3.0.0
  - Improvement
    - **重构代码逻辑**，提升可维护性
    - 增强了行内公式和行内代码块的识别逻辑
    - 增加了多种链接的识别：wiki link, markdown link and bare link.
    - 增加了多种链接的自动空格功能开关
    - 开发了**光标位置计算算法**，大大提升了行内编辑的体验
- v2.3.1
  - bug fix
    - [x] 修复数字和后面的冒号自动空格的 bug
- v2.3.0
  - improvement
    - 增加了对obsidian 和 zotero 链接的识别（`obsidian://`, `zotero://`），链接内部不自动 format
  - Bug fix
    - 修复了对部分链接内部字符无法识别的bug
- v2.2.0
  - improvement
    - 去除部分冗余代码
    - 对main.ts中类重新命名
- v2.1.0
  - bugs fix    
    - 修复上个版本中链接在某些情况下还是会被格式化的bug
- v2.0.0
  - Improvement
    - 独立设置数字和英文文本，标点的空格，数字和`.`不空格
    - list，checkbox 中支持英文行首字母大写
    - 自动识别网址链接，不格式化网址链接部分内容
    - 识别 WikiLink 和 MarkDown link，不格式化其内容
    - 设置面板分类更加清晰
  - Bug fix
    - inline 元素的范围识别逻辑
- v1.0.0
  - 基本功能完成