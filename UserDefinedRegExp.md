# 自定义正则区块
在有些情况下，用户不希望对某特定形式的内容进行格式化，比如 `{}` 内部的内容，或者 `<>` 内部的内容。**本插件可以通过用户自定义正则表达式的方式来让本插件对特定形式的内容不进行格式化**。

此外，每条自定义正则匹配块都可以设置其左右两边的空格策略。

![](https://yaozhuwa-cloud.oss-cn-hangzhou.aliyuncs.com/Pictures/20220926002222.png)

三种空格策略分别用三个符号来表示，不要求空格（-），软空格（=），严格空格（+）。

想要了解正则表达式的使用，可以查看 [《阮一峰：正则表达式简明教程》](https://javascript.ruanyifeng.com/stdlib/regexp.html#)

## 自定义正则表达式语法
在自定义正则表达式的文本编辑区域，每一行字符串都为一个正则规则，其格式如下：
```
<正则表达式>|<左空格策略><右空格策略>
```
## 自定义正则表达式规则示例
举例说明，如默认正则表达式区块的第二行内容如下：
```
#[\u4e00-\u9fa5\w\/]+|++
```
首先最后的两个字符串为该正则区块的左右空格策略，这里为++代表左右空格策略都为严格空格。

倒数第三个字符必须为 | ，其用于将正则表达式部分和左右空格策略部分分开，使其视觉上更容易辨认。

剩下的字符串为正则表达式本身，`#[\u4e00-\u9fa5\w\/]+`，该正则表达式可以匹配以 `#` 键开头的后续有一个或者多个符合 `[\u4e00-\u9fa5\w\/]` 范围的字符，该字符包含汉字、字母、数字、下划线以及 / 符号。

这样说起来比较复杂，简单点就是用来识别 Obsidian 中的标签（即 tag）的。

Obsidian 的标签需要在标签左右都添加空格（中文标点符号也不行，必须是空格），否则不会识别为标签。

![](https://yaozhuwa-cloud.oss-cn-hangzhou.aliyuncs.com/Pictures/input-tag-plugin-off.gif)

![](https://yaozhuwa-cloud.oss-cn-hangzhou.aliyuncs.com/Pictures/input-tag-plugin-on.gif)

上面两张 Gif 演示了使用该自定义正则表达式前后，在 Obsidian 输入标签时的不同。

## 更多自定义正则的应用
### 1. 识别网络连接、本地文件链接
```
(file:///|https?://|ftp://|obsidian://|zotero://|www.)[^\s（）《》。,，！？;；：“”‘’\)\(\[\]\{\}']+|++
```
识别本地文件链接、网络连接、obsidian链接、zotero链接、ftp链接，防止误格式化。
### 识别 callout 语法块
```
\[\!.*?\][-+]{0,1}|-+
```
识别 callout 语法块的头部，防止误格式化。
### 识别双尖括号
`<.*?>|--` 是用来识别双尖括号块的，保证其内部文本不被自动格式化影响。如在使用 Templater 插件创建模板时，需要使用 `<% tp.file.cursor() %>` 这样的语法。启用该自定义规则可以防止其内容被错误添加空格（因为内部的点号会被认为句子的结束，从而本插件会自动在点号与后面的文本间添加空格）。

### 识别数字时间
```
\d{2}:\d{1,2}|++
```
识别如同 12:16 这样的时间文本，不会对其自动格式化导致空格的误添加。

### 识别标签 tag
```
#[\u4e00-\u9fa5\w\/]+|++
```

